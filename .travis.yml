language: c
before_install:
  - sudo apt-get -qq update
install:
  - sudo apt-get install -qq make
  - . pre.sh
  - . ../../build.sh
  - # オレオレ証明書をつくって nginx -t をごまかす。
  - openssl genrsa -out server.key 512
  - echo jp > expect
  - for i in `seq 1 10`; echo >> expect
  - cat expect | openssl req -new -key server.key -out server.csr
  - openssl x509 -days 3650 -req -signkey server.key -in server.csr -out server.crt
  - sudo mv server.crt /etc/nginx/ssl/server.crt
  - sudo mv server.key /etc/nginx/ssl/server.key
  - # ごまかしここまで。
  - sudo cp nginx.conf /etc/nginx/nginx.conf
script:
  - sudo /opt/nginx/sbin/nginx -t
